<div class="max-w-3xl mx-auto px-6 py-12">
  <header class="mb-12 text-center">
    <h1 class="text-4xl font-bold mb-2 font-serif">Well Read</h1>
    <p class="text-lg opacity-80 italic font-serif">A digital sanctuary for your library.</p>
  </header>

  <main>
    <% if @books.any? %>
      <div class="space-y-12 mb-16">
        <% @books.each do |book| %>
          <div class="bg-white border border-deep-ink/10 p-8 rounded shadow-sm hover:shadow-md transition duration-300 relative overflow-hidden">
            <div class="flex flex-col md:flex-row gap-8 items-center mb-6">
              <% if book.cover_image_url.present? %>
                <div class="w-24 md:w-32 flex-shrink-0 shadow-lg rounded-sm overflow-hidden bg-deep-ink/5">
                   <img src="<%= book.cover_image_url %>" alt="<%= book.title %>" class="w-full h-auto">
                </div>
              <% end %>
              
              <div class="text-center md:text-left flex-1">
                 <span class="text-xs uppercase tracking-widest opacity-60 mb-2 block">Currently Reading</span>
                 <h2 class="text-3xl font-bold font-serif mb-1">
                   <%= link_to book.title, book, class: "hover:text-deep-ink/80" %>
                 </h2>
                 <p class="opacity-80 font-sans text-lg"><%= book.author %></p>
              </div>
            </div>
            
            <%= render "books/session_manager", book: book %>
          </div>
        <% end %>
      </div>
    <% else %>
      <!-- Empty State / Search -->
      <div class="space-y-12 mb-16">
        <div class="text-center">
           <h2 class="text-2xl font-serif font-bold mb-4">Ready to start something new?</h2>
           
           <!-- Search Form -->
           <%= form_with url: root_path, method: :get, data: { controller: "search", turbo_frame: "want_to_read_results" }, class: "max-w-md mx-auto relative mb-8" do |f| %>
             <div class="relative">
               <%= f.text_field :query, 
                   placeholder: "Search your library...", 
                   data: { action: "input->search#submit" },
                   class: "w-full border-deep-ink/20 focus:border-deep-ink focus:ring-0 rounded-full bg-white pl-12 pr-4 py-3 shadow-sm" 
               %>
               <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 absolute left-4 top-1/2 -translate-y-1/2 text-deep-ink/40">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                </svg>
             </div>
           <% end %>
        </div>

        <turbo-frame id="want_to_read_results">
           <% if @want_to_read_books.any? %>
             <div class="space-y-6">
                <% @want_to_read_books.each do |book| %>
                  <div class="bg-white border border-deep-ink/10 p-6 rounded shadow-sm hover:shadow-md transition duration-300 flex flex-col md:flex-row items-center justify-between gap-4">
                    <div class="flex items-center gap-4 text-center md:text-left flex-1">
                      <% if book.cover_image_url.present? %>
                        <div class="w-12 h-18 flex-shrink-0 shadow-sm rounded-sm overflow-hidden bg-deep-ink/5">
                          <img src="<%= book.cover_image_url %>" alt="<%= book.title %>" class="w-full h-full object-cover">
                        </div>
                      <% end %>
                      <div>
                        <h3 class="text-xl font-bold font-serif mb-1 text-left"><%= book.title %></h3>
                        <p class="opacity-80 font-sans text-sm text-left"><%= book.author %></p>
                      </div>
                    </div>
                    
                    <div id="<%= dom_id book, :session_controls %>">
                      <%= button_to "Start Reading", book_path(book, book: { status: "currently_reading", started_at: Time.current }, redirect_to: root_path), method: :patch, data: { turbo_frame: "_top" }, class: "px-6 py-2 bg-deep-ink text-cream font-bold rounded-full text-sm hover:opacity-90 transition cursor-pointer" %>
                    </div>
                  </div>
                <% end %>
             </div>
           <% elsif params[:query].present? %>
             <div class="text-center py-12 opacity-60">
               <p>No matching books found.</p>
             </div>
           <% end %>
        </turbo-frame>
      </div>
    <% end %>

    <!-- Overall Stats -->
    <div class="mb-12 border-t border-b border-deep-ink/10 py-8">
      <!-- Row 1 -->
      <div class="grid grid-cols-3 gap-4 mb-8">
        <div class="text-center">
          <span class="block text-3xl font-bold font-serif mb-1"><%= @total_books_completed %></span>
          <span class="text-xs uppercase tracking-widest opacity-60">Books Finished</span>
        </div>
        <div class="text-center border-l border-deep-ink/10">
          <span class="block text-3xl font-bold font-serif mb-1"><%= @total_pages_read %></span>
          <span class="text-xs uppercase tracking-widest opacity-60">Pages Turned</span>
        </div>
        <div class="text-center border-l border-deep-ink/10">
          <span class="block text-3xl font-bold font-serif mb-1"><%= @total_hours_read %></span>
          <span class="text-xs uppercase tracking-widest opacity-60">Hours Read</span>
        </div>
      </div>

      <!-- Row 2 -->
      <div class="grid grid-cols-3 gap-4 pt-8 border-t border-deep-ink/10">
        <div class="text-center">
          <span class="block text-3xl font-bold font-serif mb-1"><%= @total_ppm %></span>
          <span class="text-xs uppercase tracking-widest opacity-60">Avg. PPM</span>
        </div>
        <div class="text-center border-l border-deep-ink/10">
          <span class="block text-3xl font-bold font-serif mb-1"><%= @avg_session_minutes %>m</span>
          <span class="text-xs uppercase tracking-widest opacity-60">Avg. Session</span>
        </div>
        <div class="text-center border-l border-deep-ink/10">
          <span class="block text-3xl font-bold font-serif mb-1"><%= @current_streak %></span>
          <span class="text-xs uppercase tracking-widest opacity-60">Day Streak</span>
        </div>
      </div>
    </div>

    <!-- Footer Action -->
    <div class="text-center">
      <p class="mb-4 text-deep-ink/60 italic">Catalog more volumes or review your archives.</p>
      <%= link_to "Manage Library", books_path, class: "inline-block border-b-2 border-deep-ink text-deep-ink font-bold hover:border-deep-ink/50 transition pb-0.5" %>
    </div>
  </main>
</div>
